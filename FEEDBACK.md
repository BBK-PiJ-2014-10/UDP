A very good attempt at a messy problem. Please also see the general comments.
